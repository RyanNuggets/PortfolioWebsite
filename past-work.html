<!-- past-work.html (FULL FILE) -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Past Work – Nugget Studios</title>
  <link rel="stylesheet" href="css/style.css">
</head>

<body class="page-layout">
  <!-- NAVBAR -->
  <nav class="navbar fade-in">
    <div class="nav-inner">
      <a href="/" class="nav-home">
        <img src="images/logo2.png" alt="Navbar Logo" class="nav-logo">
      </a>

      <span class="divider"></span>
      <a href="/about" class="nav-link">About</a>

      <span class="divider"></span>
      <a href="/clients" class="nav-link">Clients</a>

      <span class="divider"></span>
      <a href="/past-work" class="nav-link">Past Work</a>

      <span class="divider"></span>
      <a href="/contact" class="nav-link">Contact</a>
    </div>
  </nav>

  <!-- CONTENT -->
  <main class="page-content fade-in">
    <section class="pastwork">
      <div class="pastwork-shell">
        <h1 class="pastwork-title">Past Work</h1>
        <p class="pastwork-sub">Scroll to explore. The centered piece is highlighted.</p>

        <div class="pastwork-feed" id="pastworkFeed" aria-label="Past work gallery"></div>

        <p class="pastwork-empty" id="pastworkEmpty" style="display:none;">
          No files found. Add images in <code>/images</code> named like <code>work-1.png</code>, <code>work-abc.jpg</code>, etc.
        </p>
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="footer-strip">
    <div class="footer-divider"></div>
    <div class="footer-inner">
      <img src="images/logo2.png" class="footer-logo" alt="Footer Logo">
      <p class="footer-text">Copyright © 2026 Nugget Studios. All rights reserved.</p>
    </div>
  </footer>

  <script>
    const feed = document.getElementById("pastworkFeed");
    const empty = document.getElementById("pastworkEmpty");

    function getRouteId() {
      const parts = window.location.pathname.split("/").filter(Boolean);
      const idx = parts.indexOf("past-work");
      if (idx === -1) return null;
      return parts[idx + 1] || null; // /past-work/:id
    }

    function renderItems(items) {
      feed.innerHTML = "";

      items.forEach((item) => {
        const wrap = document.createElement("article");
        wrap.className = "work-item";
        wrap.setAttribute("tabindex", "0");
        wrap.dataset.id = item.id;

        const img = document.createElement("img");
        img.className = "work-img";
        img.src = item.url;
        img.alt = item.id;

        wrap.appendChild(img);

        // Click -> focus + update URL
        wrap.addEventListener("click", () => {
          const newPath = `/past-work/${item.id}`;
          if (window.location.pathname !== newPath) {
            history.pushState({}, "", newPath);
          }
          wrap.scrollIntoView({ behavior: "smooth", block: "center" });
        });

        // Keyboard -> Enter/Space
        wrap.addEventListener("keydown", (e) => {
          if (e.key === "Enter" || e.key === " ") {
            e.preventDefault();
            wrap.click();
          }
        });

        feed.appendChild(wrap);
      });
    }

    // ✅ Active = the item closest to the viewport center
    function setupCenterActive() {
      const items = Array.from(document.querySelectorAll(".work-item"));

      function setActiveClosestToCenter() {
        const centerY = window.innerHeight / 2;

        let bestEl = null;
        let bestDist = Infinity;

        for (const el of items) {
          const r = el.getBoundingClientRect();
          const visible = r.bottom > 0 && r.top < window.innerHeight;
          if (!visible) continue;

          const elCenter = r.top + r.height / 2;
          const dist = Math.abs(elCenter - centerY);

          if (dist < bestDist) {
            bestDist = dist;
            bestEl = el;
          }
        }

        if (bestEl) {
          items.forEach((el) => el.classList.remove("is-active"));
          bestEl.classList.add("is-active");
        }
      }

      // run once on load
      setActiveClosestToCenter();

      // update on scroll (rAF throttle)
      let ticking = false;
      window.addEventListener("scroll", () => {
        if (!ticking) {
          ticking = true;
          requestAnimationFrame(() => {
            setActiveClosestToCenter();
            ticking = false;
          });
        }
      }, { passive: true });

      // update on resize
      window.addEventListener("resize", setActiveClosestToCenter);
    }

    function scrollToRouteId(routeId) {
      if (!routeId) return;

      const target = document.querySelector(`.work-item[data-id="${CSS.escape(routeId)}"]`);
      if (target) {
        target.scrollIntoView({ behavior: "auto", block: "center" });
      }
    }

    async function init() {
      try {
        const res = await fetch("/api/past-work");
        const data = await res.json();

        if (!data.ok || !data.items || data.items.length === 0) {
          empty.style.display = "block";
          return;
        }

        renderItems(data.items);

        // Start roughly in the middle for a nicer initial look
        const mid = Math.floor(data.items.length / 2);
        const midEl = feed.querySelectorAll(".work-item")[mid];
        if (midEl) midEl.scrollIntoView({ behavior: "auto", block: "center" });

        // Deep link override
        const routeId = getRouteId();
        if (routeId) scrollToRouteId(routeId);

        setupCenterActive();
      } catch (e) {
        empty.style.display = "block";
      }
    }

    // Back/forward support
    window.addEventListener("popstate", () => {
      const routeId = getRouteId();
      if (routeId) scrollToRouteId(routeId);
    });

    init();
  </script>
</body>
</html>
