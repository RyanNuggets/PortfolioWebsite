<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Order Status – Nugget Studios</title>
  <link rel="stylesheet" href="css/style.css" />
</head>

<body class="page-layout">
  <!-- NAVBAR -->
  <nav class="navbar fade-in">
    <div class="nav-inner">
      <a href="/" class="nav-home">
        <img src="images/logo2.png" alt="Navbar Logo" class="nav-logo">
      </a>

      <span class="divider"></span>
      <a href="/about" class="nav-link">About</a>

      <span class="divider"></span>
      <a href="/clients" class="nav-link">Clients</a>

      <span class="divider"></span>
      <a href="/past-work" class="nav-link">Past Work</a>

      <span class="divider"></span>
      <a href="/contact" class="nav-link">Contact</a>
    </div>
  </nav>

  <!-- CONTENT -->
  <main class="page-content fade-in">
    <section class="board">
      <div class="board-shell">
        <div class="board-head" style="justify-content:center; flex-direction:column; text-align:center;">
          <div>
            <h1 class="board-title" style="margin:0 0 10px;">Order Status</h1>
            <p class="board-sub" style="margin:0;">Read-only view</p>
          </div>
        </div>

        <div id="board" style="margin-top:18px;"></div>

        <p class="board-mini" style="text-align:center;">
          This board updates automatically. If something looks wrong, message me.
        </p>
      </div>
    </section>
  </main>

  <!-- FOOTER -->
  <footer class="footer-strip">
    <div class="footer-divider"></div>
    <div class="footer-inner">
      <img src="images/logo2.png" class="footer-logo" alt="Footer Logo">
      <p class="footer-text">Copyright © 2026 Nugget Studios. All rights reserved.</p>
    </div>
  </footer>

  <script>
    // --- CONFIG (client never shows Archived) ---
    const STATUSES = ["Queued", "In Progress", "Review", "Delivered"];

    // --- ELEMENTS ---
    const board = document.getElementById("board");

    // --- HELPERS ---
    const esc = (s) => String(s ?? "").replace(/[&<>"']/g, (c) => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    }[c]));

    function groupByStatus(items) {
      const map = {};
      STATUSES.forEach(s => (map[s] = []));
      items.forEach(o => {
        if (map[o.status]) map[o.status].push(o);
      });
      return map;
    }

    // --- RENDER (OLD STYLE) ---
    function renderBoard(orders) {
      const grouped = groupByStatus(orders);

      board.innerHTML = `
        <div class="kanban">
          ${STATUSES.map((status) => {
            const cards = (grouped[status] || []).map((o) => `
              <article class="order-card">
                <div class="order-top">
                  <div class="order-title">${esc(o.title)}</div>
                  <div class="order-badge">${esc(o.status)}</div>
                </div>
                <div class="order-meta">
                  <div class="order-line"><span>Client:</span> ${esc(o.client)}</div>
                  <div class="order-line"><span>Updated:</span> ${esc(o.updatedAt || "—")}</div>
                </div>
                <p class="order-notes">${esc(o.notes || "")}</p>
              </article>
            `).join("");

            return `
              <section class="col">
                <div class="col-head">
                  <div class="col-title">${esc(status)}</div>
                  <div class="col-sub">${(grouped[status] || []).length} orders</div>
                </div>
                <div class="col-body">
                  ${cards || `<div class="col-empty">No orders here yet.</div>`}
                </div>
              </section>
            `;
          }).join("")}
        </div>
      `;
    }

    // --- LOAD (client) ---
    async function loadOrders() {
      const res = await fetch("/api/orders");
      const data = await res.json();

      // ✅ hide archived for clients
      const visible = (data.items || []).filter(o => o.status !== "Archived");

      renderBoard(visible);
    }

    loadOrders();
    setInterval(loadOrders, 4000);
  </script>
</body>
</html>
